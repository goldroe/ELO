#load "stdio.elo"

main :: () -> s32 {
    printf("Hello World!\n");
 
    numbers := .{19,5,17,6,90,52,31,67,79,57};

    for z := 0; z < 10; z += 1 {
        printf("%d ", numbers[z]);
    }
    puts("");

    cells: [32][32]int;
    cells_copy: [32][32]int;

    cells[5][6] = 1;
    cells[5][7] = 1;
    cells[5][8] = 1;
    cells[6][7] = 1;

    map_width  := 32;
    map_height := 32;

    iterations := 10;

    for i := 0; i <= iterations; i += 1 {
        printf("==========IT: %d============\n", i);
        for a := 0; a < map_height; a += 1 {
            for b := 0; b < map_width; b += 1 {
                ch := 0x20;
                if cells[a][b] {
                    ch = 0x2A;
                }
                putchar(ch);
            }
            putchar(0xA);
        }

        // copy cells
        for c := 0; c < map_height; c += 1 {
            for d := 0; d < map_width; d += 1 {
                cells_copy[c][d] = cells[c][d];
            }
        }

        for y := 0; y < map_height; y += 1 {
            for x := 0; x < map_width; x += 1 {
                live := 0;
                if x > 0 {
                    live += cells_copy[y][x-1];
                }
                if x < map_width - 1 {
                    live += cells_copy[y][x + 1];
                }
                if y > 0 {
                    live += cells_copy[y-1][x];
                    if x > 0 {
                        live += cells_copy[y-1][x-1];
                    }
                    if x < map_width - 1 {
                        live += cells_copy[y-1][x+1];
                    }
                }
                if y < map_height - 1 {
                    live += cells_copy[y + 1][x];
                    if x > 0 {
                        live += cells_copy[y+1][x-1];
                    }
                    if x < map_width - 1 {
                        live += cells_copy[y+1][x+1];
                    }
                }

                cell := *cells[y][x];
                alive := cell.*;

                if alive == 1 {
                    // under population
                    if live < 2 {
                       cell.* = 0;
                    }
                    // over population
                    if live > 3 {
                       cell.* = 0;
                    }
                }

                if alive == 0 {
                    // birth
                    if live == 3 {
                        cell.* = 1;
                    }
                }
            }
        }
    }

    printf("Goodbye World!\n");

    return 0;
}
